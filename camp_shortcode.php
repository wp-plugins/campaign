<?phpadd_shortcode('campaign_funding', 'campaign_funding_func');function campaign_funding_func() {    global $wpdb, $table_prefix, $campaignClass;    if (isset($_GET['cp_login'])) {        return user_cp_login();    } elseif (isset($_GET['cp_reg'])) {        return user_cp_reg();    } elseif (isset($_GET['cp_forgot'])) {        return cp_user_forgot();    } elseif (isset($_GET['cp_details']) && $_GET['cp_details'] != '') {       return camp_details($_GET['cp_details']);    } elseif (isset($_GET['camp_search']) && $_GET['camp_search']) {        return camp_search_listing();    } elseif (isset($_GET['cp_forgotpass']) && $_GET['cp_forgotpass'] != '') {        return cp_reset_pass();    }    else        return homepage_layout();}function homepage_layout() {    $str = '<div class="sponsor_wrapper">';    $str.= '<div class="sm_nav">';   if (!is_user_logged_in()) {                $str.='<div class="sm_nav_left">Recently Added Campaign</div>';        $str.='<div class="sm_nav_right">';        $str.='<div class="sm_search_log">';        $str.='<form name="camp_frm" method="get" action="" >';        $str.='<input type="text" name="camp_search" value="Enter your keyword" class="search_filed" onclick="if (this.defaultValue==this.value) this.value=\'\'" onblur="if (this.value==\'\') this.value=this.defaultValue" />';        $str.='<input type="submit" name="camp_search_submit" value="Go" class="search_btn" />';        $str.='</form>';        $str.='	</div>';        $str.='<div class="sm_reg_log"><a href="' . get_permalink() . '/?cp_login">Login</a> <a href="' . get_permalink() . '/?cp_reg ">Register</a></div>';        $str.= '</div>';        $str.= '</div>';        $str.= recent_campaign_listing();    }else {        $str.= user_account_func();    }    $str.='</div>';    return $str;}function user_account_func(){    global $wpdb, $table_prefix, $campaignClass, $user_ID;    $userdata = get_userdata($user_ID);    $fname = get_usermeta($user_ID, 'first_name');    $lname = get_usermeta($user_ID, 'last_name');    $dob = get_usermeta($user_ID, 'cp_user_dob');    $amount_to_acheive = get_user_meta($get_campinfo->post_author, '_amount_to_achieve', true);    $time_to_acheive = get_user_meta($get_campinfo->post_author, '_time_to_achieve', true);    $current_date = date('Y-m-d');    $time_left = ( strtotime($time_to_acheive) - strtotime($current_date));    $time = date('z', $time_left);    if($time_to_acheive == '')        $time = 'Not Given';    if (isset($_POST['cp_user_edit_submit'])) {        global $user_ID;        $first_name = strip_tags(trim($_POST['cp_user_fname']));        $last_name = strip_tags(trim($_POST['cp_user_lname']));        $dob = strip_tags(trim($_POST['cp_user_dob']));        $email = strip_tags(trim($_POST['cp_user_email']));        $old_pass = strip_tags(trim($_POST['cp_user_old_pass']));        $new_pass = strip_tags(trim($_POST['cp_user_new_pass']));        update_user_meta($user_ID, 'first_name', $first_name);        update_user_meta($user_ID, 'last_name', $last_name);        update_user_meta($user_ID, 'cp_user_dob', $dob);        $user_old_pass = get_user_meta($user_ID, 'cp_user_pass');        $userdata = array('ID' => $user_ID, 'user_email' => $email);        if ($old_pass != '' && $new_pass != '') {            if ($old_pass == $user_old_pass) {                $userdata['user_pass'] = $new_pass;                update_user_meta($user_ID, 'cp_user_pass', $new_pass);                $msg = '<div>Changes Succesfully Saved</div>';            } else {                $msg = '<div>Old Password Not Matched</div>';            }        } else {            $msg = '<div>Changes Succesfully Saved</div>';        }        wp_update_user($userdata);        set_transient('cp_user_edit_msg', $msg, 30);        wp_redirect(get_permalink());        exit;    }    $str = get_transient('cp_user_edit_msg');    delete_transient('cp_user_edit_msg');    $str .= get_transient('camp_create_msg');    delete_transient('camp_create_msg');        if (isset($_GET['edit']) && $_GET['edit'] != '') {        $edit_id = base64_decode($_GET['edit']);        $profile_display = 'display:none;';        $cp_form_display = '';    } else{        $profile_display = '';        $cp_form_display = 'display:none;';    }        $str.= '<div class="sm_nav_right">';    $str.= '<div class="sm_reg_log">';    $str.= '<a href="' . wp_logout_url(get_permalink()) . '">Logout</a>';    $str.= '<a href="javascript:void(0);" id="cp_home" onclick="cpshowhide(\'cp_home\');">Home</a><a href="javascript:void(0);" id="cp_user_profile" onclick="cpshowhide(\'cp_user_profile\');">My Profile</a> <a href="javascript:void(0);" id="cp_create_camp" onclick="cpshowhide(\'cp_create_camp\');" >Create Camp</a>';    $str.= '<a href="javascript:void(0);" id="cp_camp_view " onclick="cpshowhide(\'cp_camp_view\');">Manage Camp</a>';    /* ===============Extra Work Start From Here=========================== */    $str .= '<a href="javascript:void(0)" id="cp_save" onclick="cpshowhide(\'cp_save\');">Save&work</a>';    $str.= '</div>';    $str.= '</div>';    $str.= '</div>';                /*=======================See Home View For The user===================*/    $str.='<div id="cp_home_view" style="display:none;">';    $str.= recent_campaign_listing();    $str.='</div>';        $str.= '<div id="cp_edit_profile" style="' . $profile_display . '">';    $str.= '<div id="cp_user_edit_form_msg" style="display: none;"></div>';    $str.= '<div class="edit_prof_frm">';    $str.= '<form name="edit_prof_frm" method="post" action="" onsubmit="return cp_edit_form();">';    /* =========================Achieve Amount And Time To Achieve==================== */    $str.= '<div class="log_field_con">';    $str.= '<label>First Name :</label><input type="text" name="cp_user_fname" value="' . $fname . '" class="logIn_field" />';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>Last Name :</label><input type="text" name="cp_user_lname" value="' . $lname . '" class="logIn_field" />';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>Date of Brith :</label><input type="text" name="cp_user_dob" value="' . $dob . '" class="logIn_field" />';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>Your Email :</label><input type="text" name="cp_user_email" id="cp_user_edit_email" value="' . $userdata->user_email . '" class="logIn_field" />';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>Old Password :</label><input type="password" name="cp_user_old_pass" id="cp_user_old_pass" value="" class="logIn_field" />';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>New Pasword :</label><input type="text" name="cp_user_new_pass" id="cp_user_new_pass" value="" class="logIn_field" />';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>&nbsp;</label><input type="submit" name="cp_user_edit_submit" value="Save Changes" class="save_changes_btn" />';    $str.= '</div>';    $str.= '</form>';    $str.= '</div>';    $str.= '</div>';    $str.= '<div id="cp_create_campaign" style="' . $cp_form_display . '">';    $str.= cp_create_campaign();    $str.= '<div class="clr"></div>';    $str.= '</div>';    $str .= '<div id="cp_manage_camp" style="display:none;">' . cp_manage_camp() . '</div>';    $str .= '<div id="cp_save_work" style="display:none;">' . save_and_work_listing() . '</div>';       return $str;}function recent_campaign_listing() {    $postargs = array(        'numberposts' => -1,        'post_type' => 'campaign',        'order' => 'DESC',        'post_status' => 'publish'    );    $get_campaign = get_posts($postargs);    $str = '<div class="campaign_wrapper">';    if (COUNT($get_campaign) > 0) {        foreach ($get_campaign as $campaign) {           $brandname = get_post_meta($campaign->ID, 'camp_brand', true);           $experience = get_post_meta($campaign->ID, 'camp_exp', true);           $attachment_id = get_post_meta($campaign->ID, '_camp_pic', true);           $image_arr = wp_get_attachment_image_src($attachment_id, 'thumbnail');           $status = get_post_meta($campaign->ID, '_camp_status', true);           $first_name = get_user_meta($campaign->post_author, 'first_name', true);           $last_name = get_user_meta($campaign->post_author, 'last_name', true);           $facebook_page = get_post_meta($campaign->ID, '_camp_facebook_page', true);           $twiiter_page = get_post_meta($campaign->ID, '_camp_twiiter_page', true);           $linkedin_page = get_post_meta($campaign->ID, '_camp_linkedin_page', true);           $check_live_or_not = get_post_meta($campaign->ID, '_camp_is_live', true);            if ($check_live_or_not == '1'):                if ($status != 'block') {                    $str.= '<div class="single_camp">';                    $str.= '<div class="campaign_title"><a href="' . get_permalink() . '?cp_details=' . $campaign->ID . '">' . $campaign->post_title . '</a></div>';                    $str.= '<div class="campaign_by">By ' . $first_name . ' ' . $last_name . '</div>';                    $str.= '<div class="campaign_brand"><span>Brand Name:</span>' . $brandname . '</div>';                    $str.= '<div class="campaign_experience"><span>Experience:</span>' . $experience . ' Year</div>';                    $str.='<div class="campaign_img"><div class="campaign_img_top"></div><img src="' . $image_arr[0] . '" /></div>';                    $str.='<div class="campaign_containt">' . short_content(70, $campaign->post_content) . '</div>';                    $str.='<div align="right">';                    if ($facebook_page != '')                        $str.='<span class="" ><a href="' . $facebook_page . '"><img src="' . plugins_url() . '/campaign/images/camp_facebook.png"/></a></span>' . ' ';                    if ($twiiter_page != '')                        $str.='<span class=""><a href="' . $twiiter_page . '"><img src="' . plugins_url() . '/campaign/images/camp_twitter.png"/></a></span>' . ' ';                    if ($linkedin_page != '')                        $str.='<span class=""><a href="' . $linkedin_page . '"><img src="' . plugins_url() . '/campaign/images/camp_linkedin.png"/></a></span>';                    $str.='</div>';                    $str.='<div class="campaign_btn">';                    $str.='<a class="cap_btn" href="' . get_permalink() . '?cp_details=' . $campaign->ID . '">View More</a>';                    $str.='</div>';                    $str.='</div>';                } else {                    $str.= '<div>No Campaign Added................</div>';                }            endif;        }    } else {        $str.= '<div>No Campaign Added................</div>';    }    $str.= '</div>';    return $str;}function cp_manage_camp() {    global $current_user;    $userid = $current_user->ID;    $postargs = array(        'numberposts' => -1,        'author' => $userid,        'post_type' => 'campaign',        'order' => 'DESC',        'post_status' => 'publish'    );   $get_campaign = get_posts($postargs);   $str = '<div class="campaign_wrapper">';    if (COUNT($get_campaign) > 0) {        foreach ($get_campaign as $campaign) {            $brandname = get_post_meta($campaign->ID, 'camp_brand', true);            $experience = get_post_meta($campaign->ID, 'camp_exp', true);            $attachment_id = get_post_meta($campaign->ID, '_camp_pic', true);            $image_arr = wp_get_attachment_image_src($attachment_id, 'thumbnail');            $status = get_post_meta($campaign->ID, '_camp_status', true);            $first_name = get_user_meta($campaign->post_author, 'first_name', true);            $last_name = get_user_meta($campaign->post_author, 'last_name', true);            $facebook_page = get_post_meta($campaign->ID, '_camp_facebook_page', true);            $twiiter_page = get_post_meta($campaign->ID, '_camp_twiiter_page', true);            $linkedin_page = get_post_meta($campaign->ID, '_camp_linkedin_page', true);            $check_live_or_not = get_post_meta($campaign->ID, '_camp_is_live', true);            if ($check_live_or_not == '1'):                if ($status != 'block') {                    $str.= '<div class="single_camp">';                    $str.= '<div class="campaign_title"> ' . $campaign->post_title . '</div>';                    $str.= '<div class="campaign_by">By ' . $first_name . ' ' . $last_name . '</div>';                    $str.= '<div class="campaign_brand"><span>Brand Name:</span>' . $brandname . '</div>';                    $str.= '<div class="campaign_experience"><span>Experience:</span>' . $experience . ' Year</div>';                    $str.='<div class="campaign_img"><div class="campaign_img_top"></div><img src="' . $image_arr[0] . '" /></div>';                    $str.='<div class="campaign_containt">' . short_content(70, $campaign->post_content) . '</div>';                    $str.='<div align="right">';                    if ($facebook_page != '')                        $str.='<span class="" ><a href="' . $facebook_page . '"><img src="' . plugins_url() . '/campaign/images/camp_facebook.png"/></a></span>' . ' ';                    if ($twiiter_page != '')                        $str.='<span class=""><a href="' . $twiiter_page . '"><img src="' . plugins_url() . '/campaign/images/camp_twitter.png"/></a></span>' . ' ';                    if ($linkedin_page != '')                        $str.='<span class=""><a href="' . $linkedin_page . '"><img src="' . plugins_url() . '/campaign/images/camp_linkedin.png"/></a></span>';                    $str.='</div>';                    $str.='<div class="campaign_btn">';                    $str.='</div>';                    $str.='</div>';                } else {                    $str.= '<div>No Campaign Added................</div>';                }            endif;        }    } else {        $str.= '<div>No Campaign Added................</div>';    }    $str.= '</div>';    return $str;}?>