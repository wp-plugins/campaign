<?phpfunction cp_create_campaign() {    if (isset($_GET['edit']) && $_GET['edit'] != '') {        $id = base64_decode($_GET['edit']);        $edit_data = get_campaign_for_user($id);    }    save_work_func();    create_camp_live();    $deadline = get_option('camp_deadline');    if ($deadline == '')        $deadline = 30;    $str = '';    $str.= '<div class="cp_edit_profile">';    $str.= '<div class="edit_prof_frm">';    $str.= '<h4 style="font-size:14px; color:#e3564f; text-indent:16px;">Once You Have Set to live you cannot Edit The Campaign</h4>';    $str.= '<h2 style="font-size:14px; color:#e3564f; text-indent:16px;">Add Campaign</h2>';    $str.= '<div id="cp_camp_form_msg" style="display: none;"></div>';    $str.= '<form name="add_camp" method="post" action="" enctype="multipart/form-data" onsubmit="return camp_validation();">';    $str.= '<div class="log_field_con">';    $str.= '<label>Campaign Name:</label><input type="text" name="cp_camp_name" id="cp_camp_name" value="' . $edit_data['title'] . '" class="logIn_field" />';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>Designer Personal Info:</label><textarea name="cp_personal_info" id="cp_personal_info" class="cp_user_brief_info" style="width:214px;" >' . $edit_data['camp_info'] . '</textarea>';    $str.= '</div class="log_field_con">';    $str.= '<div class="log_field_con">';    $str.= '<label>Brand Name:</label><input type="text" name="cp_brand_name" id="cp_brand_name" value="' . $edit_data['brand_name'] . '" class="logIn_field" />';    $str.= '</div class="log_field_con">';    $str.= '<div class="log_field_con">';    $str.= '<label>Experience:</label><input type="text" name="cp_camp_exp" id="cp_camp_exp" value="' . $edit_data['exp'] . '" class="logIn_field" />';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>Upload Images:</label><input type="file" name="cp_camp_image" id="cp_camp_image" class="logIn_field" />';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>Video</label><textarea name="cp_camp_video" id="cp_camp_video" class="cp_user_brief_info" style="width:214px;">' . $edit_data['camp_video'] . '</textarea>';    $str.= '<span class="embed_code">(put youtube embed code )</span>';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>Campaign Duration</label><input type="text" name="camp_duration" id="camp_duration" value="' . $edit_data['camp_duartion'] . '" class="logIn_field" />';    $str.= '<span class="embed_code">(Maximum ' . $deadline . ' Days)</span>';    $str.= '<input type="hidden" id="hidden_camp_duration" name="hidden_camp_duration" value="' . $deadline . '" class="logIn_field" />';    $str.= '</div>';    $str.= '<div class="log_field_con">';    $str.= '<label>Facebook Page:</label><input type="text" name="cp_fb" id="cp_brand_name" value="' . $edit_data['facebook'] . '" class="logIn_field" />';    $str.= '</div class="log_field_con">';    $str.= '<div class="log_field_con">';    $str.= '<label>Twitter Page:</label><input type="text" name="cp_twitter" id="" value="' . $edit_data['twitter'] . '" class="logIn_field" />';    $str.= '</div class="log_field_con">';    $str.= '<div class="log_field_con">';    $str.= '<label>Linkedin Page:</label><input type="text" name="cp_linkedin" id="" value="' . $edit_data['linkedin'] . '" class="logIn_field" />';    $str.= '</div class="log_field_con">';       $str.= '<div class="log_field_con">';    $str.= '<label>&nbsp;</label> <input type="submit" name="create_camp_submit" value="Create and Live" class="login_btn" />';    /* ==================New Added Portion==================== */    if (!isset($_GET['edit']))        $str .='<label>&nbsp;</label> <input type="submit" name="save_camp_submit" value="Save & Work" class="login_btn" />';    $str.= '</div>';    $str.= '</form>';    $str.= '</div>';    $str.= '</div>';    return $str;}function save_image($images, $post_id) {    require_once(ABSPATH . "wp-admin" . '/includes/file.php');    require_once(ABSPATH . "wp-admin" . '/includes/media.php');    require_once(ABSPATH . "wp-admin" . '/includes/image.php');    $id = get_post_meta($post_id, '_camp_pic', true);    ;    if ($id != '') {        wp_delete_attachment($id);    }    $uploads = wp_handle_upload($images, array('test_form' => false));    //$image_url = $upload['url'];    $filenames = $uploads['file'];    $wp_filetype = wp_check_filetype(basename($filenames), null);    $wp_upload_dir = wp_upload_dir();    $attachment = array(        'guid' => $wp_upload_dir['baseurl'] . _wp_relative_upload_path($filenames),        'post_mime_type' => $wp_filetype['type'],        'post_title' => preg_replace('/\.[^.]+$/', '', basename($filenames)),        'post_content' => '',        'post_status' => 'inherit'    );    $attach_id = wp_insert_attachment($attachment, $filenames, $post_id);    $attach_data = wp_generate_attachment_metadata($attach_id, $filenames);    wp_update_attachment_metadata($attach_id, $attach_data);    update_post_meta($post_id, '_camp_pic', $attach_id);}function save_work_func() {    if (isset($_POST['save_camp_submit'])) {        global $user_ID, $campaignClass;        $campname = strip_tags(trim($_POST['cp_camp_name']));        $campinfo = strip_tags(trim($_POST['cp_personal_info']));        $campbrand = strip_tags(trim($_POST['cp_brand_name']));        $campexp = strip_tags(trim($_POST['cp_camp_exp']));        $campimage = $_FILES['cp_camp_image'];        $campvideo = $_POST['cp_camp_video'];        $camp_duration = stripslashes($_POST['camp_duration']);        $camp_facebook = $_POST['cp_fb'];        $camp_twiiter = $_POST['cp_twitter'];        $camp_linkedin = $_POST['cp_linkedin'];        /*$amount_to_acheive = stripslashes($_POST['camp_asso_amt']);        $time_to_acheive = stripslashes($_POST['time_goal']);*/         if ($campname == '') {            $msg = '<div>Please Enter Campaign Name</div>';        } else if ($campinfo == '') {            $msg = '<div>Please Enter Designer Info</div>';        } else if ($campbrand == '') {            $msg = '<div>Please Enter Brand Name</div>';        } else if ($campexp == '') {            $msg = '<div>Please Enter Experience</div>';        } else if ($campimage['name'] == '') {            $msg = '<div>Please Upload Image</div>';        } else if ($campvideo == '') {            $msg = '<div>Please Enter Video Code</div>';        } else if ($camp_duration == '') {            $msg = '<div>Please Enter Campaign Duration</div>';        } else {                $camp_args = array();                $camp_args['post_title'] = $campname;                $camp_args['post_content'] = $campinfo;                $camp_args['post_author'] = $user_ID;                $camp_args['post_type'] = 'campaign';                $camp_args['post_status'] = 'publish';                $campaign_id = wp_insert_post($camp_args);            update_post_meta($campaign_id, 'camp_exp', $campexp);            update_post_meta($campaign_id, 'camp_video', $campvideo);            update_post_meta($campaign_id, 'camp_brand', $campbrand);            update_post_meta($campaign_id, 'camp_author', 'true');            update_post_meta($campaign_id, '_camp_status', 'active');            update_post_meta($campaign_id, '_cam_duration', $camp_duration);            update_post_meta($campaign_id, '_camp_facebook_page', $camp_facebook);            update_post_meta($campaign_id, '_camp_twiiter_page', $camp_twiiter);            update_post_meta($campaign_id, '_camp_linkedin_page', $camp_linkedin);            update_post_meta($campaign_id, '_camp_is_live', 0);            save_image($campimage, $campaign_id);            $msg = '<div>Your campaign is Saved.go to the Save & Work tab to Live it.</div>';        }        set_transient('camp_create_msg', $msg, 30);        $location = get_permalink();        wp_safe_redirect($location);        exit;    }}function create_camp_live() {    if (isset($_POST['create_camp_submit'])) {        global $user_ID, $campaignClass;        if (isset($_GET['edit']) && $_GET['edit'] != '')            $id = base64_decode($_GET['edit']);        $campname = strip_tags(trim($_POST['cp_camp_name']));        $campinfo = strip_tags(trim($_POST['cp_personal_info']));        $campbrand = strip_tags(trim($_POST['cp_brand_name']));        $campexp = strip_tags(trim($_POST['cp_camp_exp']));        $campimage = $_FILES['cp_camp_image'];        $campvideo = $_POST['cp_camp_video'];        $camp_duration = $_POST['camp_duration'];        $camp_facebook = $_POST['cp_fb'];        $camp_twiiter = $_POST['cp_twitter'];        $camp_linkedin = $_POST['cp_linkedin'];        if ($campname == '') {            $msg = '<div>Please Enter Campaign Name</div>';        } else if ($campinfo == '') {            $msg = '<div>Please Enter Designer Info</div>';        } else if ($campbrand == '') {            $msg = '<div>Please Enter Brand Name</div>';        } else if ($campexp == '') {            $msg = '<div>Please Enter Experience</div>';        } else if ($campimage['name'] == '') {            $msg = '<div>Please Upload Image</div>';        } else if ($campvideo == '') {            $msg = '<div>Please Enter Video Code</div>';        } else if ($camp_duration == '') {            $msg = '<div>Please Enter Campaign Duration</div>';        } else {            $camp_args = array();            $camp_args['post_title'] = $campname;            $camp_args['post_content'] = $campinfo;            $camp_args['post_author'] = $user_ID;            $camp_args['post_type'] = 'campaign';            $camp_args['post_status'] = 'publish';            if ($id != '') {                $camp_args['ID'] = $id;                $campaign_id = wp_update_post($camp_args);            } else {                $campaign_id = wp_insert_post($camp_args);            }            update_post_meta($campaign_id, 'camp_exp', $campexp);            update_post_meta($campaign_id, 'camp_video', $campvideo);            update_post_meta($campaign_id, 'camp_brand', $campbrand);            update_post_meta($campaign_id, 'camp_author', 'true');            update_post_meta($campaign_id, '_camp_status', 'active');            update_post_meta($campaign_id, '_cam_duration', $camp_duration);            update_post_meta($campaign_id, '_camp_facebook_page', $camp_facebook);            update_post_meta($campaign_id, '_camp_twiiter_page', $camp_twiiter);            update_post_meta($campaign_id, '_camp_linkedin_page', $camp_linkedin);            update_post_meta($campaign_id, '_camp_is_live', 1);            save_image($campimage, $campaign_id);            $msg = '<div>Your campaign is now live.Return to the homepage to review it</div>';        }        set_transient('camp_create_msg', $msg, 30);        $location = get_permalink();        wp_safe_redirect($location);        exit;    }}function get_campaign_for_user($id) {    $post_data = get_post($id);    $brandname = get_post_meta($id, 'camp_brand', true);    $experience = get_post_meta($id, 'camp_exp', true);    $attachment_id = get_post_meta($id, '_camp_pic', true);    $image_arr = wp_get_attachment_image_src($attachment_id, 'thumbnail');    $status = get_post_meta($id, '_camp_status', true);    $first_name = get_user_meta($post_data->post_author, 'first_name', true);    $last_name = get_user_meta($post_data->post_author, 'last_name', true);    $facebook_page = get_post_meta($id, '_camp_facebook_page', true);    $twiiter_page = get_post_meta($id, '_camp_twiiter_page', true);    $linkedin_page = get_post_meta($id, '_camp_linkedin_page', true);    $check_live_or_not = get_post_meta($id, '_camp_is_live', true);    $camp_duration = get_post_meta($id, '_cam_duration', true);    $camp_video = get_post_meta($id, 'camp_video', true);    $post_data_arr['title'] = $post_data->post_title;    $post_data_arr['camp_info'] = $post_data->post_content;    $post_data_arr['brand_name'] = $brandname;    $post_data_arr['exp'] = $experience;    $post_data_arr['image'] = $image_arr[0];    $post_data_arr['fname'] = $first_name;    $post_data_arr['lname'] = $last_name;    $post_data_arr['facebook'] = $facebook_page;    $post_data_arr['twitter'] = $twiiter_page;    $post_data_arr['linkedin'] = $linkedin_page;    $post_data_arr['camp_duration'] = $camp_duration;    $post_data_arr['camp_video'] = $camp_video;    return $post_data_arr;}?>